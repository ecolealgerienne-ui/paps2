# Dockerfile pour développement avec hot reload
FROM node:20-alpine

# Installer les dépendances système nécessaires
RUN apk add --no-cache openssl postgresql-client

# Créer le répertoire de l'application
WORKDIR /app

# Copier seulement package.json pour installer les dépendances (depuis ./api)
COPY api/package*.json ./

# Installer toutes les dépendances (y compris devDependencies pour le dev)
RUN npm install

# Copier le script d'entrypoint (depuis la racine du projet)
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Exposer le port de l'API
EXPOSE 3000

# Note: Les sources (src, prisma, etc.) seront montées via volumes
# Prisma generate et migrate seront exécutés au lancement via entrypoint

ENTRYPOINT ["docker-entrypoint.sh"]
